**Name**: Sophia Kim<br>
**ID**: 20166433<br>
**Group Number**: 2<br>

## Project Implementation Status

| Function Name | Implementation Status (Complete/Partial) | Missing Elements |
| ------------- | --------------------- | ---------------- |
| add_book_to_catalog | Complete | N/A (However, some bug fixes are needed) |
| catalog | Complete | N/A |
| borrow_book_by_patron | Complete | N/A (However, some bug fixes are needed) |
| return_book_by_patron | Partial | A return interface that verifies the book was borrowed by the patron, updates available copies, records return date, and calculates and displays any late fees owed. |
| calculate_late_fee_for_book | Partial | An API endpoint GET that calculates late fees for overdue books based on books that are due 14 days after borrowing, $0.50/per for first 7 days overdue, $1.00/day for each day after 7 days until a maximum overdue fee of $15.00 per book. Should return a JSON response with fee amount and days overdue. |
| search_books_in_catalog | Partial | Search functionality for search term and type (title, author, ISBN) that allows for partial matching of title/author and exact matching for ISBN. Should also return results in catalog display format.|
| get_patron_status_report | Partial | Display patron status for particular patron that includes currently borrowed books with due dates, total late fees owed, number of books currently borrowed, and borrowing history. Also missing web interface (menu option to show patron status in main interface) |

## Summary of the Tests Scripts
NOTE: In creating the unit tests, I aimed to cover as many of the functional requirements as possible, with an emphasis on input validation, business rules, and bug detection. As a side, I was unsure if I needed to create some sort of functionality that will delete the library.db database and restart the server after each test, so I left that part out. For testing purposes, please delete the library.db file and restart the server before re-running pytest. I was also told by the Head TA to not do things like interface testing or database testing, so I tried to stick to testing only the business logic functions and the its implementation. Finally, I created more than 4-5 unit tests for some business logic functions as I noticed that the instructions said to make sure that we have *at least* 4-5 unit tests. However, I used this selectively and especially when some more thorough testing was needed for bug detection.

#### R1 Test Script (R1_test.py)
This test script tests the implmentation of the business logic function  for R1. add_book_to_catalog() is a function that adds a new book to the catalog given the following fields: title, author, ISBN, and total copies.

NOTE: For R1, I intentionally left out the test cases already covered in sample_test.py and chose to focus on other cases instead. That's why you may notice mainly negative test cases as def test_add_book_valid_input() in sample_test.py already covered the main positive case.

test_add_book_invalid_total_copies_negative(): This test was to test adding a book with total copies being a negative integer. Since total copies should always be a positive integer, I checked that the test should return False and that the correct error message was also being returned.

test_add_book_invalid_title_too_long(): This negative test case was to test adding a book where the title is more than 200 characters. The test input passes a title with 201 characters and expects that the function will return False and the proper error message will be given. While testing, I noticed that there was some discrepancy between the functional requirements description and the error message for title length. requirements_specifications.md says that the title should be a maximum of 200 characters and the function does indeed return False if title is more than 200 characters, but the error message says "Title must be less than 200 characters." which insinuates that the title cannot be exactly 200 characters. This error message likely needs to be amended to reflect the requirements more accurately.

test_add_book_invalid_author_too_long(): This test was to test adding a book where the author input is more than 100 characters. The test inputs an author with 101 characters and expects the function to return False, along with the proper error message. The same requirements vs. error message discrepancy (see test_add_book_invalid_title_too_long()) was seen here as the error message says "Author must be less than 100 characters.", which implies that the author cannot be exactly 100 characters. This error message likely needs to be amended to reflect the requirements more accurately.

test_add_book_invalid_duplicate_isbn(): Tested adding a book with a duplicate ISBN by giving it different inputs for the other fields but attempting to add two books with the same ISBN. This should return False and trigger appropriate error message.

test_add_book_invalid_isbn_input_none_type(): Tested adding a book with None as the input for ISBN. Should have returned False and triggered some sort of custom error message, but there is no error handling for a TypeError in this case. ISBN input should be exactly 13 digits and should be a string type. Proper error handling for this case is needed in add_book_to_catalog().

test_add_book_invalid_isbn_input_whitespace(): Tested adding a book with whitespace characters in a string for ISBN input. Again, there is no error handling to make sure that the function is only accepting a string of 13 digits, so it returns True instead of False. This is also needing to be corrected, along with adding an appropriate error message.

test_add_book_invalid_isbn_input_not_digits(): Tested adding a book with non-digits in a string for ISBN input. Again, there is no error handling to make sure that the function is only accepting a string of 13 digits, so it returns True instead of False. This is also needing to be corrected, along with adding an appropriate error message.


#### R2 Test Script (R1_test.py)
This test script tests the implmentation of the business logic function  for R2. For R2, I was again told not to do any interface testing, so instead of testing if the books in the catalog are being displayed in a table format, I tested whether the books are being fetched properly or not for display. To do so, I made a test for each of the attributes (book id, title, author, isbn, available copies, total copies)that should be present in the response from get_all_books() in routes/catalog_routes.py

test_get_all_books_id(): Tested if books are being fetched properly or not for display by testing if "id" key is included in each returned row by get_all_books() and that the type is an integer.

test_get_all_books_title(): Tested if books are being fetched properly or not for display by testing if "title" key is included in each returned row by get_all_books() and that the type is a string.

test_get_all_books_author(): Tested if books are being fetched properly or not for display by testing if "author" key is included in each returned row by get_all_books() and that the type is a string.

test_get_all_books_isbn(): Tested if books are being fetched properly or not for display by testing if "isbn" key is included in each returned row by get_all_books() and that the type is a string.

test_get_all_books_total_copies(): Tested if books are being fetched properly or not for display by testing if "total_copies" key is included in each returned row by get_all_books() and that the type is an integer.

test_get_all_books_available_copies(): Tested if books are being fetched properly or not for display by testing if "available_copies" key is included in each returned row by get_all_books() and that the type is an integer.

#### R3 Test Script (R1_test.py)
This test script tests the implmentation of the business logic function for R3. borrow_book_by_patron() should allow the patron to borrow a book, validate patron ID, check book availability, patron borrowing limits, and ensure that the borrowing record was created and updated.

test_borrow_book_valid_input(): Tested a positive case of adding all valid inputs. Since it's a correct input, it should return True and provide the appropriate confirmation message.

test_borrow_book_invalid_patron_id(): Tested multiple different cases with invalid patron ID to check patron ID input validation. Patron ID should be a string with 6 digits, so I gave it an invalid patron ID that was did not use digits, one with less than 6 digits and one with more than 6 digits. All these cases should return False and provoke the error message.

test_borrow_book_invalid_book_doesnt_exist(): Tested borrowing a book that does not exist by giving it a book_id that does not exist. False should be returned with the appropriate error message.

test_borrow_book_invalid_no_availability(): Tested borrowing a book that is not currently available by giving it a book that exists but has no available copies currently. As there already exists a sample book in the database that always starts with 0 copies, I used that in my test case. Should return False, alongside the correct error message.

test_borrow_book_invalid_exceeded_borrowing_limit(): Tested borrowing a book where the patron has exceeded the maximum borrowing limit of 5 books. In this test case, I had a specific patron borrow a book 5 times and expected that it would return False when trying to borrow a 6th book. However, a bug was detected when found that the patron can borrow up to 6 books because of a logic error in borrow_book_by_patron() where it only returns False and triggers the error message when the patron has already borrowed more than 5 books. The bug can likely be corrected by fixing the logic to be "current_borrowed >= 5" instead of "current_borrowed > 5."

test_borrow_book_update_available_copies(): Tested book availability and the creation of a borrow record implicitly by checking out a book twice that we already know has two copies available. Then I checked to make sure that the book was borrowed successfully. After, I borrowed that book again, which returned False. It should return False, because there are no more available copies. This demonstrated that a borrowing record is being created and updated. We can also see this implicitly in the previous test as a borrowing record needs to have been created to have kept track of the number of books that a particular patron has currently borrowed.


#### R4 Test Script (R1_test.py)
This test script tests the implmentation of the business logic function  for R4 (not yet implemented). return_book_by_patron() has not yet been implemented yet, but it will process a book return by a patron by verifying the book was borrowed by the patron, updating available copies, and recording the return date. The return interface for R4 also calculates and displays any late fees owed by calling the business logic function of R5, so tests pertaining to the calculation and display of late fees will be covered in the R5 test script. I also created a helper function to retrieve information from the database in order to simulate some test conditions, as suggested to me by the Head TA. 

test_return_book_valid_input(): Tested returning a book with valid input by first borrowing a book (using the business logic function from R3) and then returning it. Once function is properly implemented, the test should return True.

test_return_book_invalid_not_curr_borrowed(): Tested returning a book that the patron has not currenty borrowed. I gave this test case a new patron id that hadn't been used before and had them return a book. This should return False. 

test_return_book_update_available_copies(): Tested if available copies is updated after returning a book by adding a new book to the catalog that has 1 total copy. Then I had a patron borrow that book (which should return True), verify that the book indeed has 0 copies available by attempting to borrow that book again (which should return False), returning that book (which should return True once function is implemented), and then borrowing that book again to verify if available copies has been updated after returning the book (which should return True). Because if available copies does not get updated, then the patron would not be allowed to borrow that book again and it would return False.

test_return_book_update_return_Date(): Tested if return date gets updated after returning the book by adding a new book to the catalog, borrowing that book, and returning that book. Upon doing so, I used the helper function I created that gets the borrow records (list of dicts) that match the patron id and book id and I check to make sure that the borrow record for this patron id and book id exists and that return date is not NULL. Because if they had not returned the book or if the return date had not been updated, the return date would be NULL.

#### R5 Test Script (R1_test.py)
This test script tests the implmentation of the business logic function  for R5 (not yet implemented). calculate_late_fee_for_book() calculates the late fees for a specific book. These late fee calculations for overdue books are based on books due 14 days after borrowing, $0.50/day for the first 7 days overdue, $1.00/day for each additional day after 7 days, and a maximum of $15.00 per book. Again, I use a helper function to simulate test cases by adding a row to the borrow_records database.

test_late_fee_calculation_less_than_seven_days(): Tested late fee calculation for an overdue book that is less than 7 days overdue. I did this by adding a row to the borrow_records database for a book that is 3 days overdue. Then I called the calculate_late_fee_for_book() function to get the fee amount and overdue days for this patron for this particular book. It should say that the fee amount is $1.50 (3 days overdue x 0.50/day for first 7 days) and the days overdue should be 3.

test_late_fee_calculation_more_than_seven_days(): Tested late fee calculation for an overdue book that is more than 7 days overdue but less than 19 days (at which point, the maximum fee amount get reached). I did this by adding a row to the borrow_records database for a book that is 8 days overdue. Then I called the calculate_late_fee_for_book() function to get the fee amount and overdue days for this patron for this particular book. It should say that the fee amount is $4.50 ((7 days x 0.50/day) + (1 day x 1.00/day)) and the days overdue should be 8.

test_late_fee_calculation_max_fee_for_book(): Tested late fee calculation for an overdue book that has reached its maximum late fee (minimum lateness threshold to reach this is 19 days). I did this by adding a row to the borrow_records database for a book that is 19 days overdue. Then I called the calculate_late_fee_for_book() function to get the fee amount and overdue days for this patron for this particular book. It should say that the fee amount is $15.00 and the days overdue should be 19.

test_late_fee_calculation_no_late_books(): Tested late fee calculation for a book that is not overdue. I did this by adding a row to the borrow_records database for a book that is not overdue. Then I called the calculate_late_fee_for_book() function to get the fee amount and overdue days for this patron for this particular book. It should say that the fee amount is $0.00 and the days overdue should be 0.

#### R6 Test Script (R1_test.py)
This test script tests the implmentation of the business logic function  for R6 (not yet implemented). search_books_in_catalog() should search for books in the catalog given a search term and a search type (title, author, isbn). It should support partial matching for title/author (case-insensitive) and support exact matching for ISBN.

test_search_books_matching_title(): Tested searching a book with an exact matching title, a partially matching title, and a non-matching title. In order to do this, I passed an exactly matching title from the database to the function (along with the appropriate search type), a partially matching title of that book by removing a few letters, and a title that does not exist in the database. The non-matching title should return a list of length 0 as the search should not provide it any results.

test_search_books_matching_author(): Tested searching a book with an exact matching author, a partially matching author, and a non-matching author. In order to do this, I passed an exactly matching author from the database to the function (along with the appropriate search type), a partially matching author of that book by removing a few letters, and an author that does not exist in the database. The non-matching author should return a list of length 0 as the search should not provide it any results.

test_search_books_case_insensitive(): Tested searching a book and an author that are both partially matching, but I mixed both upper and lowercase characters to test the case-insensitivity. In order to do this, I passed a partially matching title from the database to the function (along with the appropriate search type) and a partially matching author of that book by removing a few letters. These two sets of inputs should both return successful search results despite the case-insensitivity, which is shown through the length of the return list being 1.

test_search_books_mismatching_types(): Tested searching a book with incorrectly matched search term and search type input by giving it a title that exists in the database, but passing search type as isbn instead of title. This should return False as the search term and type are mismatched.

test_search_books_matching_isbn(): Tested searching a book with a matching and non-matching isbn by giving it an exact matching isbn (with the correct search type) and another search with a partially matching isbn. The function should return False whenever the isbn does not exist or is not exactly matching, and therefore the length of the returned list would be 0. When it's an exact match, the length of the returned list would be 1.

#### R7 Test Script (R1_test.py)
This test script tests the implmentation of the business logic function for R7 (not yet implemented). get_patron_status_report() should get a status report for a given patron that includes currently borrowed books with due dates, total late fees owed, number of books currently borrowed, and borrowing history. I use a helper function here as well to simulate test conditions by adding rows to the borrow_records database.

test_get_patron_status_report_standard(): Tested patron status for patron with a standard case where there exists a borrowing history, currently borrowed books, and late fees. I decided this as being a standard case as it covers a wide range of situations in a single patron report. I started by using the helper function to add a row to the borrow_records database for a book that was returned a day late, as well as adding a row for a book that is currently borrowed, but not yet returned nor overdue. Upon implementation of get_patron_status_report(), I tested to verify that it would output the correct patron status results such as currently borrowed books, late fees, currently borrowed books, and borrowing history.

test_get_patron_status_report_no_borrowing_history(): Tested patron status for patron with no borrowing history nor currently borrowed books. I created a new patron with no history and tested to verify that it would output that the patron has no currently borrowed books, have no late fees, and no borrowing history.

test_get_patron_status_report_multiple_late_fees(): Tested patron status for patron with a borrowing history of multiple overdue books. Here, I was particularly interested in verifying that total late fees would be correctly updated, so I had this particular patron have two since-returned books that were overdue by 4 and 20 days respectively, as well as a currently borrowed book. The late fee should properly reflected all overdue books in their borrowing history and therefore, should state that the patron owes $17.00.

test_get_patron_status_report_no_curr_books(): Tested patron status for patron with a borrowing history but no currently borrowed books. For this,I created a patron with two books that have since been returned, with one having been overdue and one having been returned on time. They also had no currently borrowed books. In this test, I wanted to verify that the borrowing history, including any outstanding late fees from their borrow history, would be reflected as well as the number of currently borrowed books being correctly reflected. 